<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NYCinema</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      padding: 0;
      background: #f6f6f6;
    }
    .day {
      background: white;
      padding: 16px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .day-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .movie {
      margin-bottom: 12px;
    }
    .movie-name {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .showtimes {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .showtime-link {
      padding: 4px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      text-decoration: none;
      color: black;
      background: #fafafa;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <h1>NYCinema</h1>

  <div style="margin-bottom: 1rem; display: flex; gap: 0.75rem; flex-wrap: wrap;">
    <label>
     Theater:
     <select id="theaterFilter">
      <!-- options will be filled by JS -->
     </select>
    </label>

    <label>
     Search movie:
     <input id="searchInput" type="text" placeholder="Type a title..." />
    </label>
  </div>
  
  <!-- THIS is the container your script fills -->
  <div id="schedule">Loading...</div>

  <script>
  let fullData = []; // will hold all days from schedule.json

  async function loadSchedule() {
    const container = document.getElementById('schedule');
    container.textContent = 'Loading...';

    try {
      const res = await fetch('schedule.json');
      if (!res.ok) {
        container.textContent = 'Failed to load schedule.json (status ' + res.status + ')';
        return;
      }

      const data = await res.json();
      fullData = data;

      setupTheaterFilter(data);
      setupSearchFilter();

      applyFilters(); // initial render
    } catch (err) {
      container.textContent = 'Error loading schedule: ' + err;
      console.error(err);
    }
  }

  function setupTheaterFilter(data) {
    const select = document.getElementById('theaterFilter');

    // Collect unique theater names
    const theaters = Array.from(new Set(
      data.map(d => d.theater || 'Unknown theater')
    )).sort();

    // Clear any existing options
    select.innerHTML = '';

    // "All" option
    const allOption = document.createElement('option');
    allOption.value = '';
    allOption.textContent = 'All theaters';
    select.appendChild(allOption);

    // One option per theater
    theaters.forEach(theater => {
      const opt = document.createElement('option');
      opt.value = theater;
      opt.textContent = theater;
      select.appendChild(opt);
    });

    // Re-render when user changes theater
    select.addEventListener('change', applyFilters);
  }

  function setupSearchFilter() {
    const input = document.getElementById('searchInput');
    input.addEventListener('input', () => {
      // tiny debounce-ish feel by just re-rendering; for small data this is fine
      applyFilters();
    });
  }

  function applyFilters() {
    const theaterSelect = document.getElementById('theaterFilter');
    const searchInput = document.getElementById('searchInput');

    const theaterFilter = theaterSelect.value; // '' means "all"
    const searchTerm = searchInput.value.trim().toLowerCase();

    // Filter days
    const filteredDays = fullData.map(day => {
      // Filter by theater first
      if (theaterFilter && (day.theater || 'Unknown theater') !== theaterFilter) {
        return null;
      }

      // If no search term, keep all movies
      if (!searchTerm) {
        return day;
      }

      // Filter movies by title match
      const filteredMovies = (day.movies || []).filter(movie =>
        movie.movie && movie.movie.toLowerCase().includes(searchTerm)
      );

      // If no movies match on this day, drop the whole day
      if (filteredMovies.length === 0) return null;

      // Otherwise, return a new day object with only matching movies
      return {
        ...day,
        movies: filteredMovies
      };
    }).filter(Boolean); // remove nulls

    renderSchedule(filteredDays);
  }

  function renderSchedule(days) {
    const container = document.getElementById('schedule');
    container.innerHTML = '';

    if (!days || days.length === 0) {
      container.textContent = 'No screenings found for this filter.';
      return;
    }

    days.forEach(day => {
      const dayDiv = document.createElement('div');
      dayDiv.className = 'day';

      const dayTitle = document.createElement('div');
      dayTitle.className = 'day-title';

      // Include theater name with the day
      const theaterName = day.theater ? ` (${day.theater})` : '';
      dayTitle.textContent = day.day + theaterName;
      dayDiv.appendChild(dayTitle);

      if (!day.movies || day.movies.length === 0) {
        const empty = document.createElement('div');
        empty.textContent = 'No movies listed for this day.';
        dayDiv.appendChild(empty);
      } else {
        day.movies.forEach(movie => {
          const movieDiv = document.createElement('div');
          movieDiv.className = 'movie';

          const movieName = document.createElement('div');
          movieName.className = 'movie-name';
          movieName.textContent = movie.movie;
          movieDiv.appendChild(movieName);

          const showtimesDiv = document.createElement('div');
          showtimesDiv.className = 'showtimes';

          (movie.times || []).forEach((time, i) => {
            const link = (movie.links || [])[i] || (movie.links && movie.links[0]) || '#';

            const a = document.createElement('a');
            a.className = 'showtime-link';
            a.href = (link || '#').trim();
            a.target = '_blank';
            a.rel = 'noopener noreferrer';
            a.textContent = time;

            showtimesDiv.appendChild(a);
          });

          movieDiv.appendChild(showtimesDiv);
          dayDiv.appendChild(movieDiv);
        });
      }

      container.appendChild(dayDiv);
    });
  }

  loadSchedule();
</script>


</body>
</html>




